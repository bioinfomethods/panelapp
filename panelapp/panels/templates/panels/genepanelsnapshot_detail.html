{% extends "default.html" %}
{% load staticfiles %}
{% block title %}{{ entry.gene.gene_symbol }} ({{ panel.level4title.name }}){% endblock %}
{% block header %}

<script src="{% static 'django_ajax/js/jquery.ajax.min.js' %}"></script>
<script src="{% static 'django_ajax/js/jquery.ajax-plugin.min.js' %}"></script>
<script src="{% static "select2.min.js" %}"></script>
{% endblock %}

{% block content %}
<ol class="breadcrumb">
    <li>
        <a href="{% url 'panels:index' %}">Panels</a>
    </li>
    <li>
        <a href="{% url 'panels:update' view.panel.panel.pk  %}">
            {{ panel.level4title.name }}
        </a>
    </li>
    <li class="active">
        {{ entry.gene.gene_symbol }}
    </li>
</ol>

<div class="row">
    <div class="col-sm-2">
        <div class="panel panel-default">
            <div class="panel-heading">Genes in panel</div>
            <div class="btn-group btn-group-justified" role="group" data-module="gene-nav">
                {% if prev_gene %}
                    <a href="{% url 'panels:evaluation' panel.panel.pk prev_gene.gene.gene_symbol %}"
                       class="gene-nav-prev btn btn-default" title="{{ prev_gene.gene.gene_symbol }}">
                        <i class="fa fa-arrow-up add-right-margin"></i>Prev
                    </a>
                {% else %}
                    <span class="gene-nav-prev btn btn-default disabled">
                        <i class="fa fa-arrow-up add-right-margin"></i>Prev
                    </span>
                {% endif %}
                {% if next_gene %}
                    <a href="{% url 'panels:evaluation' panel.panel.pk next_gene.gene.gene_symbol %}"
                       class="gene-nav-next btn btn-default" title="{{ next_gene.gene.gene_symbol }}">
                        Next<i class="fa fa-arrow-down add-left-margin"></i>
                    </a>
                {% else %}
                    <span class="gene-nav-next btn btn-default disabled">
                        Next<i class="fa fa-arrow-down add-left-margin"></i>
                    </span>
                {% endif %}
            </div>
            <ul class="list-group" data-module="gene-nav" id="gene-nav">
                {% include "Gene/gene_nav.html" %}
            </ul>
            {% if request.user.reviewer.is_verified %}
                <ul class="list-group">
                    <li class="list-group-item" style="border-top: none">
                        <a href="{% url 'panels:add_gene' view.panel.panel.pk %}">
                            <i class="fa fa-plus add-right-margin"></i>Add a gene
                        </a>
                    </li>
                </ul>
            {% endif %}
        </div>
    </div>
    <div class="col-sm-10">
        <h1 class="remove-top-margin">
            <p class="text-muted normal add-label-margin" style="font-size: 18px">{{ panel.level4title.name }}</p>
            {{ entry.gene.gene_symbol }}
        </h1>
        <span id="gene-banner-heading">{% include "Gene/gene_gel_banner.html" %}</span>
        {% if entry.ready and request.session.is_GEL %}
            <span class="banner banner-ready">Ready for major version</span>
        {% endif %}
        {% if entry %}|reviewed_by:request.session.user
            <span class="banner banner-reviewed">
                <i class="fa fa-check"></i> You reviewed
            </span>
        {% endif %}
        <hr />
        <p class="lead">
            {{ entry.gene.gene_name }}<br />
            EnsemblGeneIds:
            {% for t in entry.gene.other_transcripts %}|get_ensembleId
            <a href="http://Dec2016.archive.ensembl.org/Homo_sapiens/Gene/Summary?db=core;g={{t}}" target="_blank">{{t}}</a>{% if not forloop.last %},{% endif %}
            {% endfor %}<br />
            <a href="http://omim.org/entry/{{ entry.gene.omim_gene }}" target="_blank">OMIM: {{ entry.gene.omim_gene }}</a>, <a href=" http://www.ebi.ac.uk/gene2phenotype/gene2phenotype-webcode/cgi-bin/handler.cgi?panel=ALL&search_term={{ entry.gene.gene_symbol }}" target="_blank">Gene2Phenotype</a><br />
            {{ entry.gene.gene_symbol }} is in <a href="{% url 'panels:gene_detail' entry.gene.gene_symbol %}">{{ sharing_panels|length }} panel{{sharing_panels|pluralize}}</a>
        </p>

        <div data-module="tab-switcher" data-default-tab="evaluate">
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active">
                    <a href="#evaluate" aria-controls="evaluate" role="tab" data-toggle="tab">Reviews ({{ evaluation|length }})</a>
                </li>
                <li role="presentation">
                    <a href="#details" aria-controls="details" role="tab" data-toggle="tab">Details</a>
                </li>
                <li role="presentation">
                    <a href="#history" aria-controls="history" role="tab" data-toggle="tab">History</a>
                </li>
                {% if request.user.is_GEL %}
                    <li role="presentation">
                        <a href="#review" aria-controls="review" role="tab" data-toggle="tab">Review feedback</a>
                    </li>
                {% endif %}
            </ul>

            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="evaluate">
                    {% include "Gene/Tabs/evaluate.html" %}
                </div>
                <div role="tabpanel" class="tab-pane" id="details">
                    {% include "Gene/Tabs/details.html" %}
                </div>
                <div role="tabpanel" class="tab-pane" id="history">
                    {% include "Gene/Tabs/history.html" %}
                </div>
                {% if request.session.user_type == "GEL" %}
                    <div role="tabpanel" class="tab-pane" id="review">
                        {% include "Gene/Tabs/review.html" %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script>
    window.GeneTags = [{% for tag in tags %}{% if tag %}'{{ tag }}'{% if not forloop.last %},{% endif %}{% endif %}{% endfor %}];
</script>
{% endblock %}

{% block modals %}
  {% include "Messages/Common/rating.html" %}
  {% include "panels/modals/mode_of_path.html" %}
  {% include "panels/modals/diagnostic.html" %}
  {% include "panels/modals/mode_of_inheritance.html" %}
{% endblock %}
